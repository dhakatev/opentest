package org.getopentest.selenium;

import org.getopentest.selenium.core.SeleniumTestAction;
import org.getopentest.logging.Logger;

public class SwitchToLastWindow extends SeleniumTestAction {

    @Override
    public void run() {
        super.run();

        this.waitForAsyncCallsToFinish();
        
        String[] windowHandles = driver.getWindowHandles().stream()
                .toArray(String[]::new);

        try {
            driver.switchTo().window(windowHandles[windowHandles.length - 1]);

            Logger.info(String.format(
                    "Successfully switched to last window (number %s)",
                    windowHandles.length));
        } catch (Exception ex) {
            throw new RuntimeException(String.format(
                    "Failed to switch to last window (number %s)",
                    windowHandles.length), ex);
        }
    }
}
