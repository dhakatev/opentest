package org.getopentest.appium;

import io.appium.java_client.MobileDriver;
import io.appium.java_client.MobileElement;
import io.appium.java_client.TouchAction;
import org.getopentest.annotations.TestActionArgument;
import org.getopentest.annotations.TestActionClass;
import org.getopentest.annotations.Type;
import org.getopentest.appium.core.AppiumTestAction;
import org.openqa.selenium.By;

@TestActionClass(
        description = "Performs a long press gesture at the center of a UI "
        + "element for the specified duration.")
@TestActionArgument(name = "locator", type = Type.MAP, optional = false,
        description = "The locator of the UI element.")
@TestActionArgument(name = "durationMs", type = Type.INTEGER, optional = true,
        description = "The duration of the long press, in milliseconds. If the "
        + "durationMs argument is not specified, the long press will be held"
        + "until the contextmenu event has fired.")

/**
 * Performs a long press gesture at the center of a UI element for the specified
 * duration.
 */
public class LongPress extends AppiumTestAction {

    @Override
    public void run() {
        super.run();

        By locator = this.readLocatorArgument("locator");
        Integer durationMs = this.readIntArgument("durationMs", null);
        String swipeDirection = readStringArgument("swipe", "none");

        swipeAndCheckElementVisible(locator, swipeDirection);

        MobileElement element = getElement(locator);
        TouchAction action = new TouchAction((MobileDriver) driver);

        if (durationMs == null) {
            action.longPress(element);
        } else {
            action.longPress(element, durationMs);
        }

        action.release().perform();
    }
}
